#!/bin/bash

# hashcmp
# Checks if two or more hashes are the same
# Catches the first instance of a hash being different

RED="\e[1;31m"
GREEN="\e[1;32m"
NORMAL="\e[0m"

argc=$#
files=("$@")

# Error if two or less argcs
if (( argc < 2 )); then
    echo -e "${RED}[$0] ERROR: Argument count is less than 2.${NORMAL}"
    exit -1
fi


# An array containing filenames as keys and hashes as values
declare -a hashes
index=0
for file in "${files[@]}"; do
    
    # Check if files exist
    if [ ! -f "$file" ]; then
        echo "[$0] Cannot find file '$file'."
        exit -1
    fi

    hashes[$index]="$(sort "$file" | cut -d ' ' -f1)"
    index=$((index+1))
done

# Compare each hash file with the first one given
echo "Checking each file against file '${files[0]}'"...
failed=false
count=0
for (( i = 1; i < ${#hashes[@]}; i++ )); do

    if [[ "${hashes[0]}" != "${hashes[$i]}" ]]; then
        echo -e "${RED}${files[$i]}: FAILED${NORMAL}"
        failed=true
        count=$((count+1))

    else echo -e "${GREEN}${files[$i]}: OK${NORMAL}"
    fi
done

echo ""
echo -e "[$0] result: $count file/s failed."
if [[ $failed == true ]]; then
    exit 1

else exit 0
fi

echo -e "${RED}Unknown error occured.${NORMAL}"
exit 1
