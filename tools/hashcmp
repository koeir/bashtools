#!/bin/bash

# hashcmp
# Checks if two or more hashes are the same
# Catches the first instance of a hash being different

RED="\e[1;31m"
GREEN="\e[1;32m"
NORMAL="\e[0m"

argc=$#
argv=("$@")

# Error if two or less argcs
if (( argc < 2 )); then
    echo -e "${RED}[$0] ERROR: Argument count is less than 2.${NORMAL}"
    exit -1
fi

# Declare dynamic array for storing hashes
declare -a hashes

# Check if files exist
for (( i = 0; i < argc; i++ )); do
    if [ ! -f "${argv[$i]}" ]; then
        echo "[$0] Cannot find file ${argv[$i]}."
        exit -1
    else
        # Cut the paths of the checksums
        hashes[$i]="$(cut -d ' ' -f1 "${argv[$i]}")"
    fi
done

# Compare the checksums
for (( i = 0; i < argc - 1; i++ )); do
    if [[ "${hashes[$i]}" != "${hashes[$((i+1))]}" ]]; then
        echo -e "${RED}${argv[$i]}: ${hashes[$i]}: FAILED"
        echo -e "${argv[$((i+1))]}: ${hashes[$((i+1))]}: FAILED${NORMAL}"
        echo "[$0] NOTE: Only the first instance of a hash being different is called out."
        exit 1
    fi
done

echo -e "${GREEN}${@}: OK${NORMAL}"
exit 0
